{"version":3,"sources":["../src/app.js"],"names":["routers","helper","env","sessionStorage","funct","logger","configs","hbs","sessionCookieConfig","app","info","use","extended","contentSecurityPolicy","sync","name","SESSION_NAME","secret","COOKIES_SECRET","resave","saveUninitialized","cookie","store","migrateDatabase","express","path","join","__dirname","set","engine","req","res","next","data","title","message_type","ALERT","PRIMARY","checkSessionApi","api","checkSession","routerAdmin","editRouter","routerAuth","migrationRouter","get","loginRoute","err","error","message","status","json"],"mappings":"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","sourcesContent":["import express from 'express'\r\nimport { json, urlencoded } from 'body-parser'\r\nimport compression from 'compression'\r\nimport path from 'path'\r\nimport session from 'express-session'\r\nimport cookieParser from 'cookie-parser'\r\nimport helmet from 'helmet'\r\nimport helper from './helper'\r\nimport { checkSession, checkSessionApi } from './helper/sessionHelper'\r\nimport { ALERT } from './helper/css/alert'\r\nimport { loginRoute } from './routers/auth'\r\nimport genError from './helper/errorHelper'\r\n\r\nconst { routers, env, sessionStorage, funct, logger } = helper\r\nconst { hbs, sessionCookieConfig } = helper.configs\r\n\r\nconst app = express()\r\n\r\nlogger.info('App initializing...')\r\n// middlewares\r\napp.use(json())\r\napp.use(urlencoded({ extended: true }))\r\napp.use(compression())\r\napp.use(\r\n  helmet({\r\n    contentSecurityPolicy: false,\r\n  }),\r\n)\r\n\r\n//session\r\nsessionStorage.sync()\r\napp.use(session({\r\n  name: env.SESSION_NAME,\r\n  secret: env.COOKIES_SECRET,\r\n  resave: false,\r\n  saveUninitialized: true,\r\n  cookie: sessionCookieConfig,\r\n  store: sessionStorage,\r\n}))\r\napp.use(cookieParser(env.COOKIES_SECRET))\r\n\r\nlogger.info('Db migrating...')\r\n// migration\r\nfunct.migrateDatabase()\r\n\r\n// static files\r\napp.use(express.static(path.join(__dirname, '../static')))\r\n\r\n//view engine\r\napp.set('views', path.join(__dirname, '../views'))\r\napp.set('view engine', 'hbs')\r\napp.engine('hbs', hbs.engine)\r\n\r\n// global routers\r\napp.use((req, res, next) => {\r\n  res.data = {}\r\n  res.data.title = 'DS Web'\r\n  res.data.message_type = ALERT.PRIMARY\r\n  next()\r\n})\r\n\r\napp.use('/api', checkSessionApi, routers.api)\r\napp.use('/admin', checkSession, routers.routerAdmin)\r\napp.use('/edit', checkSession, routers.editRouter)\r\napp.use('/auth', routers.routerAuth)\r\napp.use('/migration', routers.migrationRouter)\r\n\r\napp.get('/', loginRoute)\r\n\r\n// error handling\r\napp.use((err, req, res, next) => {\r\n  err = genError(err, req)\r\n  helper.logger.error(err.message, err)\r\n  \r\n  res.status(500).json({\r\n    message: 'Some error, please contact your developer',\r\n    error\r\n  })\r\n})\r\n\r\nexport default app"],"file":"app.js"}