{"version":3,"sources":["../../src/routers/migration.js"],"names":["router","get","req","res","next","query","key","env","MIGRATION_KEY","logger","info","sendStatus","process","nextTick","migrations","json","message"],"mappings":";;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AAEA;;AACA;;;;;;AAEA,IAAMA,MAAM,GAAG,sBAAf;AAEAA,MAAM,CAACC,GAAP,CAAW,GAAX,EAAgB,UAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAClC,MAAIF,GAAG,CAACG,KAAJ,CAAUC,GAAV,KAAkBC,gBAAIC,aAA1B,EAAyC;AACvCC,uBAAOC,IAAP,CAAY,mBAAZ,EAAiC;AAAEJ,MAAAA,GAAG,EAAEJ,GAAG,CAACG,KAAJ,CAAUC;AAAjB,KAAjC;;AACAH,IAAAA,GAAG,CAACQ,UAAJ,CAAe,GAAf;AACD,GAHD,MAGO;AACLP,IAAAA,IAAI;AACL;AACF,CAPD,EAOG,UAACF,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACrBQ,EAAAA,OAAO,CAACC,QAAR,CAAiB,YAAM;AACrB,QAAIC,UAAU,GAAG,0BAAjB;AACAX,IAAAA,GAAG,CAACY,IAAJ,CAAS;AACPC,MAAAA,OAAO,EAAE,qBADF;AAEPF,MAAAA,UAAU,EAAVA;AAFO,KAAT;AAID,GAND;AAOD,CAfD;eAiBed,M","sourcesContent":["import { Router } from 'express'\r\nimport Umzug from 'umzug'\r\nimport Sequelize from 'sequelize'\r\nimport db from '../helper/db'\r\nimport { migrateDatabase } from '../helper/db'\r\nimport logger from '../logger'\r\nimport env from '../env'\r\n\r\nconst router = Router()\r\n\r\nrouter.get('/', (req, res, next) => {\r\n  if (req.query.key !== env.MIGRATION_KEY) {\r\n    logger.info('migration attempt', { key: req.query.key })\r\n    res.sendStatus(404)\r\n  } else {\r\n    next()\r\n  }\r\n}, (req, res, next) => {\r\n  process.nextTick(() => {\r\n    let migrations = migrateDatabase()\r\n    res.json({\r\n      message: 'migration completed',\r\n      migrations,\r\n    })\r\n  })\r\n})\r\n\r\nexport default router"],"file":"migration.js"}