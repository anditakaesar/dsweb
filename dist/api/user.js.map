{"version":3,"sources":["../../src/api/user.js"],"names":["userRouter","User","db","FormatUser","user","newUser","undefined","id","role","username","get","req","res","process","nextTick","findAndCountAll","where","ROLES","STAFF","then","results","data","rows","forEach","i","push","json","message","count","err","helper","logger","error","errmsg","findOne","params","result","post","body","password","passwordConfirm","Error","hasPass","bcrypt","hashSync","env","SALT_HASH","update","request"],"mappings":"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","sourcesContent":["import { Router } from 'express'\r\nimport db from '../helper/db'\r\nimport helper from '../helper'\r\nimport { ROLES } from '../helper/constants/roles'\r\nimport bcrypt from 'bcrypt'\r\nimport genError from '../helper/errorHelper'\r\n\r\nconst userRouter = Router()\r\nconst { User } = db\r\n\r\nfunction FormatUser(user) {\r\n  let newUser = {}\r\n  if (user != null && user != undefined) {\r\n    newUser.id = user.id\r\n    newUser.role = user.role\r\n    newUser.username = user.username\r\n  }\r\n  return newUser\r\n}\r\n\r\nuserRouter.get('/all', (req, res) => {\r\n  process.nextTick(() => {\r\n    User.findAndCountAll({\r\n      where: { role: ROLES.STAFF },\r\n    })\r\n    .then((results) => {\r\n      let data = []\r\n      results.rows.forEach((user, i) => {\r\n        data.push(FormatUser(user))\r\n      })\r\n      res.json({\r\n        message: 'all users loaded',\r\n        data,\r\n        count: results.count,\r\n      })\r\n    })\r\n    .catch((err) => {\r\n      helper.logger.error(err.message, genError(err, req))\r\n      res.json({\r\n        message: 'error',\r\n        errmsg: err.message,\r\n      })\r\n    })\r\n  })\r\n})\r\n\r\nuserRouter.get('/:id', (req, res) => {\r\n  process.nextTick(() => {\r\n    User.findOne({\r\n      where: { id: req.params.id },\r\n    })\r\n    .then((result) => {\r\n      res.json({\r\n        message: 'user loaded',\r\n        user: FormatUser(result),\r\n      })\r\n    })\r\n    .catch((err) => {\r\n      helper.logger.error(err.message, genError(err, req))\r\n      res.json({\r\n        message: 'error',\r\n        errmsg: err.message,\r\n      })\r\n    })\r\n  })\r\n})\r\n\r\nuserRouter.post('/:id', (req, res) => {\r\n  process.nextTick(() => {\r\n    User.findOne({\r\n      where: { id: req.params.id },\r\n    })\r\n    .then((user) => {\r\n      // update\r\n      if (req.body.password != req.body.passwordConfirm) {\r\n        throw new Error('Password and Confirm Password must be same!');\r\n      }\r\n      if (user) {\r\n        let hasPass = bcrypt.hashSync(req.body.password, helper.env.SALT_HASH)\r\n        user.update({\r\n          username: req.body.username,\r\n          password: hasPass,\r\n        })\r\n      }\r\n      res.json({\r\n        message: 'POST INVOKED',\r\n        user,\r\n        request: req.body\r\n      })\r\n    })\r\n    .catch((err) => {\r\n      helper.logger.error(err.message, genError(err, req))\r\n      res.json({\r\n        message: 'error',\r\n        errmsg: err.message,\r\n      })\r\n    })\r\n  })\r\n})\r\n\r\nexport default userRouter"],"file":"user.js"}